import{a as K,r as l,c as Q,j as e,u as V,H as z,b as E}from"./app-D9K0lIg2.js";import{A as G}from"./app-layout-DjmuWQS6.js";import{a as J}from"./assetColumns-qh1rGxWr.js";import{I as v}from"./input-Cdacpup9.js";import{B as _}from"./button-Cq0MOVKo.js";import{S as I,A as M}from"./pagination-Dd8pkajb.js";import{D as U}from"./datatable-BVwayNB8.js";import{t as c}from"./index-Ct_SG2XW.js";import{d as W,c as X}from"./index-CoNroDVL.js";import{a as x}from"./index-CSYN4WWv.js";import{D as Y,a as Z,b as $,c as ee,d as se,e as te}from"./dialog-66DR-adO.js";import{L as w}from"./label-CiFHFGZU.js";import{a as ae}from"./index-DdjQXXqZ.js";import{C as re}from"./circle-plus-CoWCO5BP.js";/* empty css            */import"./index-BeC5lqBz.js";import"./index-BSy4OLH8.js";import"./index-CMWG4mbA.js";import"./app-img-logo-DWWu-s2u.js";import"./popover-DKDeY4ci.js";import"./checkbox-BCKvNgLQ.js";import"./index-C9Rp0xoA.js";import"./check-C5X-y35h.js";import"./list-CI-Ie8mA.js";import"./trash-C3FSZoTg.js";import"./chevron-left-BV2a4pwW.js";function le({open:n,onOpenChange:u,form:o,category:m,assetkind:p,loading:S,dsState:i}){const{data:N,setData:t,post:D,put:b,reset:g,processing:A,errors:h}=K({asset_code:"",asset_name:"",asset_category_id:null,asset_kind_id:null}),[C,F]=l.useState(!1);l.useEffect(()=>{n&&p&&m&&(i=="insert"?(t("asset_category_id",m.id),t("asset_kind_id",p.id),Q.get(x.nextCode(p.id).url).then(a=>{t("asset_code",a.data.next_code)}).catch(()=>c.error("ไม่สามารถสร้างรหัสอัตโนมัติได้"))):i=="update"&&(t("asset_category_id",m?.id||null),t("asset_kind_id",o?.kind?.id||null),t("asset_code",o?.asset_code||""),t("asset_name",o?.asset_name||"")))},[n,o,p,m,i]);const k=()=>{i=="insert"?D(x.store().url,{preserveState:!0,onSuccess:()=>{c.success("Asset created successfully."),u(!1),g()},onError:()=>c.error("Failed to create asset.")}):i=="update"&&o&&b(x.update(o.id).url,{preserveState:!0,onSuccess:()=>{c.success("Asset updated successfully."),u(!1),g()},onError:()=>c.error("Failed to update asset.")})};return e.jsx(e.Fragment,{children:e.jsx(Y,{open:n,onOpenChange:a=>{u(a),a&&g()},children:e.jsxs(Z,{children:[e.jsxs($,{children:[e.jsxs(ee,{children:[i==="insert"?"New":"Edit"," Asset"]}),e.jsx(se,{children:"Enter asset details to add a new one"})]}),S?e.jsx(I,{className:"h-8 w-full text-center",children:"Loading..."}):null,e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{htmlFor:"asset_code",className:"text-right self-start mt-1.5",children:"Code"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(v,{id:"asset_code",value:N.asset_code,onChange:a=>t("asset_code",a.target.value),className:"w-full"}),h.asset_code&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:h.asset_code})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{htmlFor:"asset_name",className:"text-right self-start mt-1.5",children:"Name"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(v,{id:"asset_name",value:N.asset_name,onChange:a=>t("asset_name",a.target.value),className:"w-full"}),h.asset_name&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:h.asset_name})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"text-right",children:"ประเภทครุภัณฑ์"}),e.jsx(v,{type:"text",value:m.name,disabled:!0,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"text-right",children:"ชนิด"}),e.jsx(v,{type:"text",value:p?.type_name??"",disabled:!0,className:"col-span-3"})]})]}),e.jsxs(te,{children:[e.jsx(_,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(_,{onClick:k,disabled:A,children:A?"Saving...":"Save"})]})]})})})}function Le(){const{rows:n,filters:u,assetkind:o,category:m,vendors:p}=V().props,[S,i]=l.useState(u?.search||""),[N,t]=l.useState(!1),[D,b]=l.useState(!1),[g,A]=l.useState(null),[h,C]=l.useState(!1),F=[{title:"Dashboard",href:W().url},{title:"Asset Categories",href:X().url}],[k,a]=l.useState("update"),L=async()=>{a("insert"),C(!0)},O=async s=>{a("update"),b(!0),C(!0);try{const j=await(await(await fetch(x.edit(s).url)).json()).asset;A(j)}finally{b(!1)}},B=s=>{confirm("Are you sure you want to delete this asset?")&&E.delete(route("assets.destroy",s),{preserveScroll:!0,onStart:()=>t(!0),onFinish:()=>{t(!1),c.info("Asset deleted.")}})},[f,P]=l.useState([]),H=J({openEdit:O,deleteAsset:B,toggleSelect:(s,r)=>{P(d=>r?[...d,s]:d.filter(j=>j!==s))},toggleSelectAll:s=>{P(s?n.data.map(r=>r.id):[])},selectedIds:f}),R=s=>{s&&E.get(s,{},{preserveState:!0,preserveScroll:!0,replace:!0,onStart:()=>t(!0),onFinish:()=>t(!1)})},T=()=>{if(f.length===0){c.warning("กรุณาเลือกรายการทรัพย์สินก่อนพิมพ์");return}const s=document.createElement("form");s.method="POST",s.action=x.qr.batch.pdf().url,s.target="_blank";const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!r){c.error("CSRF token not found");return}const d=document.createElement("input");d.type="hidden",d.name="_token",d.value=r,s.appendChild(d),f.forEach(j=>{const y=document.createElement("input");y.type="hidden",y.name="ids[]",y.value=j.toString(),s.appendChild(y)}),document.body.appendChild(s),s.submit(),document.body.removeChild(s)},q=()=>{E.get(x.index(ae).url,{search:S},{preserveState:!0,replace:!0,onStart:()=>t(!0),onFinish:()=>t(!1)})};return e.jsxs(G,{breadcrumbs:F,children:[e.jsx(z,{title:"Assets"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs("div",{className:"relative min-h-[100vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex gap-2 p-4",children:[e.jsxs(_,{onClick:L,variant:"outline",children:[e.jsx(re,{})," Add"]}),e.jsx(v,{type:"search",placeholder:"Search assets...",value:S,className:"lg:w-xs w-full",onChange:s=>i(s.target.value)}),e.jsx(_,{onClick:q,children:"Search"}),e.jsxs(_,{onClick:T,disabled:f.length===0,children:["พิมพ์ QR Code (",f.length,")"]})]}),N?e.jsx("div",{className:"p-4 space-y-3",children:Array.from({length:10}).map((s,r)=>e.jsx(I,{className:"h-8 w-full"},r))}):n?e.jsxs("div",{className:"p-4",children:[e.jsx(U,{columns:H,data:n.data}),e.jsx("div",{className:"mt-6",children:e.jsx(M,{links:n.links,onPageChange:R})})]}):e.jsx("div",{})]})}),e.jsx(le,{open:h,onOpenChange:C,form:g,category:m,assetkind:o,loading:D,dsState:k})]})}export{Le as default};
